//historico
update xeo_historico set numero_colocacion = trim (numero_colocacion);
update xeo_historico set transaccion=trim(transaccion);
update xeo_historico set tipo_doc=trim(tipo_doc);
update xeo_historico set tipo_doc=upper(tipo_doc);

update xeo_historico
set transaccion='CANCELADO'
where numero_colocacion= 'LIB-0001758'
AND CUOTA IS NULL;

update xeo_historico
set transaccion='CANCELADO'
where numero_colocacion= 'LIB-0001765'
AND CUOTA IS NULL;

update xeo_historico
set numero_colocacion= 'LIB- 0001869'
where numero_colocacion= 'LIB-0001869';

update xeo_historico
set transaccion='CANCELADO'
where numero_colocacion= 'LIB-0001878'
AND CUOTA IS NULL;

update xeo_historico
set transaccion='VIGENTE'
where numero_colocacion LIKE '%LIB-0002219%'
AND CUOTA IS NULL;

update xeo_historico
set transaccion='VIGENTE'
where numero_colocacion LIKE '%LIB-0002223%'
AND CUOTA IS NULL;

update xeo_historico
set transaccion='VIGENTE'
where numero_colocacion LIKE '%LIB-0002238%'
AND CUOTA IS NULL;

update xeo_historico
set transaccion='VIGENTE'
where numero_colocacion LIKE '%LIB-0002350%'
AND CUOTA IS NULL;

update xeo_historico
set transaccion='VIGENTE'
where numero_colocacion LIKE '%LIB-0002493%'
AND CUOTA IS NULL;


//Plan de pagos
update xeo_plandepagos set numero_credito= trim (numero_credito);

update xeo_plandepagos set modo_pago = 'Mensual'
where modo_pago='MENSUAL';

update xeo_plandepagos set modo_pago = 'Bimestral'
where modo_pago='BIMESTRAL';

update xeo_plandepagos set modo_pago = 'Trimestral'
where modo_pago='TRIMESTRAL';

update xeo_plandepagos set modo_pago = 'Semestral'
where modo_pago='SEMESTRAL';

update xeo_plandepagos set modo_pago = 'Anual'
where modo_pago='ANUAL';
	
update xeo_plandepagos 
set numero_credito= 'lib-0001737'
where numero_credito= 'LIB-0001737';

UPDATE XEO_PLANDEPAGOS
SET TASA_EA=11.3510
WHERE TASA_EA=113510.

UPDATE XEO_PLANDEPAGOS
SET MODO_PAGO='Trimestral'
where modo_pago='TRIMESTREL';

---------------------------------------------------
----m_cli_liquidacion_cuota
---------------------------------------------------

SELECT distinct 'insert into m_cli_liquidacion_cuota (s_tipo_documentoid, s_tipo_movimientoid, s_vigenciavigencia, s_periodoperiodo, estado, creacion, fecha, descripcion, consecutivo) values (41, 186, "2017", 1, "Autorizado", "01-01-2017", "'||  xh.fecha_desembolso || '","' || ced_cliente || ' - ' ||(CASE 
WHEN s_tercero.naturalezajuridica='Natural' 
	THEN s_tercero.nombre1||' '||COALESCE(s_tercero.nombre2,' ')||' '||s_tercero.apellido1||' '||COALESCE(s_tercero.apellido2,' ')
WHEN s_tercero.naturalezajuridica='Juridica' 
	THEN s_tercero.razonsocial
END) || ' - ' || ' - Num.Credito:' || xh.numero_colocacion || '",(SELECT to_char(cast(coalesce(max(consecutivo),"0") as int)+1,"FM09999999") from m_cli_liquidacion_cuota));',xh.fecha_desembolso
from xeo_historico xh
inner join s_tercero on (xh.ced_cliente=s_tercero.numero)
WHERE --(transaccion like '%VIGENTE%' or transaccion like '%CANCELADO%') and
xh.fecha_desembolso IS NOT NULL
--AND  XH.NUMERO_COLOCACION IN ('CAR-193','LIB-0002879','LIB-0002892','LIB-0002894','LIB-0002896','LIB-0002900')

order by xh.fecha_desembolso asc 

---------------------------------------------------
---m_cli_comprobante_credito
---------------------------------------------------

SELECT distinct 
'insert into m_cli_comprobante_credito (m_con_centro_contableid, s_tipo_documentoid, s_tipo_movimientoid, s_vigenciavigencia, s_periodoperiodo, estadocomprobantecredito, creacion, fecha, descripcion, fecharealdepago,consecutivo,s_terceroid) values (1, 42, 187, "2017", 1, "Autorizado","01-01-2017", "'||  xh.fecha_movimiento || '","' || xh.ced_cliente || ' - ' ||(CASE 
WHEN s_tercero.naturalezajuridica='Natural' 
	THEN s_tercero.nombre1||' '||COALESCE(s_tercero.nombre2,' ')||' '||s_tercero.apellido1||' '||COALESCE(s_tercero.apellido2,' ')
WHEN s_tercero.naturalezajuridica='Juridica' 
	THEN s_tercero.razonsocial
END) || ' - ' ||  ' - Num.Credito:' || xh.numero_colocacion || '","'||case when 
(xh.numero_colocacion like '%LIB%') then To_char(date_trunc('month',xh.fecha_movimiento)  +'1month' ::interval -'1sec' ::interval, 'yyyy-mm-dd') 
else To_char(date_trunc('month',xh.fecha_movimiento)  +'1month' ::interval -'1sec' ::interval, 'yyyy-mm-dd') 
END || '",(SELECT to_char(cast(coalesce(max(consecutivo),"0") as int)+1,"FM09999999") from m_cli_comprobante_credito)'||','||s_tercero.ID||');',xh.fecha_movimiento
from (
	select numero_colocacion,ced_cliente,fecha_movimiento,numero_doc,count(*)
	from xeo_historico
	WHERE FECHA_MOVIMIENTO IS NOT NULL
	group by numero_colocacion,ced_cliente,fecha_movimiento,numero_doc
	having count(*)>1
	union
	--Esto se realizo debido a que se va a tomar en cuenta solo un registro por numero del documento
	select numero_colocacion,ced_cliente,fecha_movimiento,numero_doc,1
	from xeo_historico
	where numero_colocacion in ('CAR-181','CAR-182','CAR-183','CAR-186','CAR-187','CAR-188*','FAC-102','FAC-103','FAC-104','FAC-105','FAC-107')
	AND FECHA_MOVIMIENTO IS NOT NULL
	) xh
	inner join (select numero_colocacion,tipo_doc
	from xeo_historico  
	--WHERE transaccion like '%VIGENTE%'
	) xhVigente 
	on xhVigente.numero_colocacion = xh.numero_colocacion
	and xh.fecha_movimiento IS NOT NULL
	inner join s_tercero on (xh.ced_cliente=s_tercero.numero
)
--WHERE XH.numero_colocacion in ('CAR-181')
ORDER BY xh.fecha_movimiento
	
//****** Montar el s_autoriza

insert into s_autoriza(
  tipoautorizacion,
  m_rec_dependenciaid,
  m_rec_cargoid,
  s_terceroid,  
  m_cli_comprobante_creditoid)

  select 
  'Elaboro' tipoautorizacion ,
  m_rec_dependencia.id  m_rec_dependencia ,
  m_rec_cargo.id m_rec_cargo,
  s_tercero.id s_tercero,  
  m_cli_comprobante_credito.id m_cli_deposito
 
from  m_cli_comprobante_credito

left join m_rec_cargo_tercero on 268 = m_rec_cargo_tercero.s_terceroid
left join s_tercero on s_tercero.id = 268
left join m_rec_dependencia_m_rec_cargo on m_rec_dependencia_m_rec_cargo.id =m_rec_cargo_tercero.m_rec_dependencia_m_rec_cargoid
left join m_rec_dependencia on m_rec_dependencia.id =m_rec_dependencia_m_rec_cargo.m_rec_dependenciaid
left join m_rec_cargo on m_rec_cargo.id = m_rec_dependencia_m_rec_cargo.m_rec_cargoid

---------------------------------------------------
----m_cli_credito_aprobado
---------------------------------------------------

SELECT 
'insert into m_cli_credito_aprobado (m_cli_detalle_aprobacionid,m_cli_clasificacion_creditoid,m_cli_etapa_cobroid,numerocredito,fecha,descripcion,consolidardeudas,tipoconsolidaciondeuda,estadocredito,estadoparaliquidacion,formadeextincion,plazoaprobado, costoamortizado,montoaprobado,periodogracia,formadepago,modalidadpago,numeroregistrodelcredito,fecharegistrodelcredito,diadepago,tipoamortizacion,tasainterespactada,tipotasainteres,modoliquidacioninteres,spread,m_cli_clienteid,m_cli_fuente_pagoid,creacion,valorcuota,fechafin,periodicidadintereses) values (1,2,2,"'|| xh.numero_colocacion||'","'||xpp.fecha_desembolso||'","'||xh.numero_colocacion||'",'||false||',"'||'No Aplica'||'","'||'Desembolsado'||'","'||'Normal'||'","'||(CASE 
WHEN xh.transaccion='VIGENTE' 
	THEN 'Vigente'
WHEN xh.transaccion='CANCELADO' 
	THEN 'Pagado'
END)||'",'||xpp.plazo||','||false ||','|| xh.valor_desembolso ||','||0||',"'||(CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN 'Descuento nómina'
ELSE 'Efectivo' 
END)||'","'||xpp.modo_pago||'","'||xh.numero_colocacion||'","'||xpp.fecha_desembolso||'",'||MAX(to_char(extract(day from xpp.fecha_vencimiento),'99'))||',"'||(CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN 'Cuota creciente'

ELSE 'Cuota constante' 
END)||'",'||xpp.tasa_ea||',"Fijo","Vencido",'||xpp.puntos_spread||','||m_cli_cliente.id||',2,"01-01-2017",'||MAX (CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN valor_cuota
ELSE 0 
END)||',"'||xpp.fecha_fin_credito||'","'||(case
		when cast(pago_interes as int)=30 then 'Mensual'
		when cast(pago_interes as int)=60  then 'Bimestral'
		when cast(pago_interes as int)=90  then 'Trimestral'
		when cast(pago_interes as int)=120  then 'Cuatrimestral'
		when cast(pago_interes as int)=150  then 'Pentamestral'
		when cast(pago_interes as int)=180 then 'Semestral' 
		when cast(pago_interes as int)=210  then 'Septamestral'
		when cast(pago_interes as int)=240  then 'Octamestral'
		when cast(pago_interes as int)=270  then 'Nonamestral'
		when cast(pago_interes as int)=300 then 'Decamestral'
		when cast(pago_interes as int)=360 then 'Anual'
end)||'");'
from xeo_historico xh
--inner join xeo_plandepagos xpp on (xpp.numero_credito=xh.numero_colocacion and xpp.cuota=xh.cuota)
inner join xeo_plandepagos xpp on (xpp.numero_credito=xh.numero_colocacion and xh.cuota is null)
inner join s_tercero on (xh.ced_cliente=s_tercero.numero)
inner join m_cli_cliente on (s_tercero.id=m_cli_cliente.s_terceroid)
--where (transaccion like '%VIGENTE%')
group by 

xh.numero_colocacion,xpp.fecha_desembolso,xh.numero_colocacion,(CASE 
WHEN xh.transaccion='VIGENTE' 
	THEN 'Vigente'
WHEN xh.transaccion='CANCELADO' 
	THEN 'Pagado'
END),xpp.plazo,xh.valor_desembolso,
(CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN 'Descuento nómina'
ELSE 'Efectivo' 
END),xpp.modo_pago,xh.numero_colocacion,xh.fecha_desembolso,
(CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN 'Cuota creciente'
ELSE 'Cuota constante' 
END),xpp.tasa_ea,xpp.puntos_spread,m_cli_cliente.id,
xpp.fecha_fin_credito,(case
		when cast(pago_interes as int)=30 then 'Mensual'
		when cast(pago_interes as int)=60  then 'Bimestral'
		when cast(pago_interes as int)=90  then 'Trimestral'
		when cast(pago_interes as int)=120  then 'Cuatrimestral'
		when cast(pago_interes as int)=150  then 'Pentamestral'
		when cast(pago_interes as int)=180 then 'Semestral' 
		when cast(pago_interes as int)=210  then 'Septamestral'
		when cast(pago_interes as int)=240  then 'Octamestral'
		when cast(pago_interes as int)=270  then 'Nonamestral'
		when cast(pago_interes as int)=300 then 'Decamestral'
		when cast(pago_interes as int)=360 then 'Anual'
end)
/*
union 

SELECT distinct
'insert into m_cli_credito_aprobado (m_cli_detalle_aprobacionid,m_cli_clasificacion_creditoid,m_cli_etapa_cobroid,numerocredito,fecha,descripcion,consolidardeudas,tipoconsolidaciondeuda,estadocredito,estadoparaliquidacion,formadeextincion,plazoaprobado, costoamortizado,montoaprobado,periodogracia,formadepago,modalidadpago,numeroregistrodelcredito,fecharegistrodelcredito,diadepago,tipoamortizacion,tasainterespactada,tipotasainteres,modoliquidacioninteres,spread,m_cli_clienteid,m_cli_fuente_pagoid,creacion,valorcuota,fechafin,periodicidadintereses) values (1,2,2,"'|| 
xh.numero_colocacion||'","'||
xh.fecha_desembolso||'","'||
xh.numero_colocacion||'",'||
false||',"'||
'No Aplica'||'","'||
'Desembolsado'||'","'||
'Normal'||'","'||
(CASE 
WHEN xh.transaccion='VIGENTE' 
	THEN 'Vigente'
WHEN xh.transaccion='CANCELADO' 
	THEN 'PAGADO'
END)||'",0,'||
false ||','|| xh.valor_desembolso ||','||0||',"'||
(CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN 'Descuento nómina'
ELSE 'Efectivo' 
END)||'","Mensual","'||xh.numero_colocacion||'","'||
xh.fecha_desembolso||'",0,"'||
(CASE 
WHEN xh.numero_colocacion like '%LIB%' THEN 'Cuota creciente'
ELSE 'Cuota constante' 
END)||'",0,"Fijo","Vencido",0,'||
m_cli_cliente.id||',2,"2017-01-01",0,"2016-12-31","Mensual");'
from xeo_historico xh
--inner join xeo_plandepagos xpp on (xpp.numero_credito=xh.numero_colocacion and xpp.cuota=xh.cuota)
--inner join xeo_plandepagos xpp on (xpp.numero_credito=xh.numero_colocacion )
inner join s_tercero on (xh.ced_cliente=s_tercero.numero)
inner join m_cli_cliente on (s_tercero.id=m_cli_cliente.s_terceroid)
where (transaccion like '%CANCELADO%')
*/

//////******************************

update m_cli_credito_aprobado
set  m_cli_detalle_aprobacionid =1
where position ('LIB' in NUMEROCREDITO)>0;

update m_cli_credito_aprobado
set  m_cli_detalle_aprobacionid =2
where SUBSTRING(NUMEROCREDITO FROM 1 FOR 4) IN ('2006','2007','2008','2009','2011','2012','2013','2014','2015','2016'); --FOMENTO

update m_cli_credito_aprobado
set  m_cli_detalle_aprobacionid =3
where SUBSTRING(NUMEROCREDITO FROM 1 FOR 4)='2010'; --TESORERIA

update m_cli_credito_aprobado
set  m_cli_detalle_aprobacionid =4
where position ('FAC' in NUMEROCREDITO)>0;

update m_cli_credito_aprobado
set  m_cli_detalle_aprobacionid =6
where position ('CAR' in NUMEROCREDITO)>0;


//****Updates historico tipo transaccion

UPDATE XEO_HISTORICO SET TRANSACCION = TRANSACCION || '-Deuda' where transaccion='01';
UPDATE XEO_HISTORICO SET TRANSACCION = TRANSACCION || '-Mora' where transaccion='02';
UPDATE XEO_HISTORICO SET TRANSACCION = TRANSACCION || '-Int.' where transaccion in ('03','04','05','06');
UPDATE XEO_HISTORICO SET TRANSACCION = TRANSACCION || '-Seguro' where transaccion in ('08','10','11');


---------------------------------------------------
----m_cli_detalle_liquidacion_cuota
---------------------------------------------------

SELECT --Solo las cuotas que tienen movimiento en el historico
	'insert into m_cli_detalle_liquidacion_cuota (m_cli_liquidacion_cuotaid,m_cli_credito_aprobadoid,
numerocuota,inicioliquidacion,
finliquidacion,fechapago,
saldoanteriorcredito,valorcuota,
saldoanteriorcapital,capitalperiodo,saldoactualcapital,
saldoanteriorcorrientes,diasinterescorriente,porcentajecorriente,interescorrienteperiodo,saldoactualcorriente,
saldoanteriormoratorios,diasmora,interesmoratorioperiodo,porcentajemora,saldoactualmoratorios,cuotaseguro,
saldoactualseguro,saldonuevocredito,creacion,saldoanteriorseguro,abonocapital,abonocorriente,abonomoratorios,
abonoseguro) values ('||mclc.id||','||--m_cli_liquidacion_cuotaid
	mcca.id ||',"'||--m_cli_credito_aprobadoid
	xpp.cuota ||'","'||--numerocuota
	To_char(xpp.fecha_vencimiento  -(to_char(mcca.mesespago,'99')||'month') ::interval , 'yyyy-mm-dd')||'","'||--inicioliquidacion
	xpp.fecha_vencimiento||'","'||--finliquidacion
	To_char(date_trunc('month',xpp.fecha_vencimiento )  +'1month' ::interval -'1sec' ::interval, 'yyyy-mm-dd')||'",'||--fechapago
	0 ||','||--saldoanteriorcredito
	coalesce(xpp.valor_capital,0)+coalesce(xpp.valor_interes,0)||','||--valorcuota
	0 ||','||--saldoanteriorcapital
	coalesce(xpp.valor_capital,0) ||','||--capitalperiodo
	coalesce(xpp.valor_capital,0)-coalesce(xh.deuda,0) ||','||--saldoactualcapital
	0||',"'||--saldoanteriorcorrientes
	xpp.pago_interes||'",'||--diasinterescorriente
	coalesce(xpp.tasa_periodo,0) ||','||--porcentajecorriente
	coalesce(xpp.valor_interes,0) ||','||--interescorrienteperiodo
	0 ||','||--saldoactualcorriente 
	0 ||','||--Saldo anterior moratorio , tabla diana
	0 ||','||--dias mora, tabla diana
	0 ||','||--interesmoratorioperiodo
	0 ||','||--porcentajemora
	0 ||','||--saldoactualmoratorios
	coalesce(valor_seguro,0) ||','||--cuotaseguro
	0 ||','||--saldoactualseguro
	0 ||',"'|| --saldonuevocredito
	'01-01-2017'||'",'||--creacion
	0 || ','||--saldoanteriorseguro
	coalesce(xh.deuda,0) ||','||--abonocapital
	coalesce(xh.interes_corriente,0) ||','||--abonocorriente
	coalesce(xh.mora,0) ||','||--abonomoratorios
	coalesce(xh.seguro,0) ||');'--abonoseguro
from 	
	xeo_plandepagos xpp
inner join 
	(
		select ced_cliente,numero_colocacion,cuota,--valor_desembolso,
		SUM(case
		when POSITION( 'Int.' IN transaccion)>0
			then VALOR_TRANSACCION end)  interes_corriente,
		sum(case
		when POSITION( 'Seguro' IN transaccion)>0 
			then valor_transaccion end ) seguro,
		sum(case
		when POSITION( 'Deuda' IN transaccion)>0  
			then valor_transaccion end ) deuda,
		sum(case
		when POSITION( 'Mora' IN transaccion)>0  
			then valor_transaccion end ) mora,
		sum(saldo_capital)
		from xeo_historico
		where cuota is not null
		group by 1,2,3--,4
	) xh
		on (xh.numero_colocacion = xpp.numero_credito and CAST(COALESCE(xh.cuota,'0')AS INTEGER) = CAST(COALESCE(xpp.cuota,'0') AS INTEGER) )
inner join 
	(select 
	substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
	from m_cli_liquidacion_cuota) mclc
		on (trim(xpp.numero_credito) = trim(mclc.credito))
inner join 
	(select id,numerocredito,
		(case
		when modalidadpago='Mensual' then 1
		when modalidadpago='Bimestral' then 2
		when modalidadpago='Trimestral' then  3
		when modalidadpago='Cuatrimestral' then  4
		when modalidadpago='Pentamestral' then  5
		when modalidadpago='Semestral' then 6
		when modalidadpago='Septamestral' then 7
		when modalidadpago='Octamestral' then 8
		when modalidadpago='Nonamestral' then 9
		when modalidadpago='Decamestral' then 10
		when modalidadpago='Anual' then  12
		end) mesespago
		from m_cli_credito_aprobado
		--where upper(formadeextincion) like '%VIGENTE%'
	) mcca
		on (trim(mcca.numerocredito)=trim(xpp.numero_credito))
union
SELECT --Las cuotas que no tienen movimiento en el historico
	'insert into m_cli_detalle_liquidacion_cuota (
	m_cli_liquidacion_cuotaid,	m_cli_credito_aprobadoid,
	numerocuota,	inicioliquidacion,
	finliquidacion,	fechapago,
	saldoanteriorcredito,	valorcuota,
	saldoanteriorcapital,	capitalperiodo,
	saldoactualcapital,	saldoanteriorcorrientes,
	diasinterescorriente, porcentajecorriente,
	interescorrienteperiodo, saldoactualcorriente,
	saldoanteriormoratorios, diasmora,
	interesmoratorioperiodo, porcentajemora,
	saldoactualmoratorios, cuotaseguro,
	saldoactualseguro, saldonuevocredito,
	creacion, saldoanteriorseguro,
	abonocapital, abonocorriente,
	abonomoratorios, abonoseguro) values ('||mclc.id||','|| 	--mclc.id
	mcca.id ||',"'||		--mca.id
	xpp.cuota ||'","'||		--numerocuota
	To_char(xpp.fecha_vencimiento  -(to_char(mcca.mesespago,'99')||'month') ::interval , 'yyyy-mm-dd')||'","'||	--inicioliquidacion
	xpp.fecha_vencimiento||'","'||		--finliquidacion
	To_char(date_trunc('month',xpp.fecha_vencimiento )  +'1month' ::interval -'1sec' ::interval, 'yyyy-mm-dd')||'",'||	--fechapago
	0 ||','||		--saldoanteriorcredito
	coalesce(xpp.valor_capital,0)+coalesce(xpp.valor_interes,0) ||','||	--valorcuota
	0 ||','||	--saldoanteriorcapital
	coalesce(xpp.valor_capital,0) ||','||	--capitalperiodo
	coalesce(xpp.valor_capital,0) ||','||	--saldoactualcapital
	0 ||',"'||	--saldoanteriorcorrientes
	xpp.pago_interes||'",'||--diasinterescorriente
	coalesce(xpp.tasa_periodo,0)  ||','||	--porcentajecorriente
	coalesce(xpp.valor_interes,0) ||','||	--interescorrienteperiodo
	0 ||','|| 			--saldoactualcorriente
	0 ||','|| 			--saldoanteriormoratorios
	0 ||','|| 			--dias mora, tabla diana
	0 ||','||			--interesmoratorioperiodo
	0 ||','||			--porcentajemora
	0 ||','||			--saldoactualmoratorios
	coalesce(valor_seguro,0)     ||','||	--cuotaseguro
	0 ||','||								--saldoactualseguro
	0 ||',"'|| 								--saldonuevocredito
	'01-01-2017'||'",'||					--creacion
	0 || ','||								--saldoanteriorseguro
	0 ||','||								--abonocapital
	0 ||','||								--abonocorriente
	0 ||','||								--abonomoratorios
	0 ||');'								--abonoseguro
from
	xeo_plandepagos xpp
inner join 
	(
		select numero_colocacion,max (CAST(cuota AS INTEGER)) cuota
		from xeo_historico
		where cuota is not null
		group by numero_colocacion		
	) xh
		on (xh.numero_colocacion = xpp.numero_credito and CAST(xpp.cuota AS INTEGER)>CAST(xh.cuota AS INTEGER) )
inner join 
	(select 
	substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
	from m_cli_liquidacion_cuota) mclc
		on (trim(xpp.numero_credito) = trim(mclc.credito))
inner join 
	(select id,numerocredito,
		(case
		when modalidadpago='Mensual' then 1
		when modalidadpago='Bimestral' then 2
		when modalidadpago='Trimestral' then  3
		when modalidadpago='Cuatrimestral' then  4
		when modalidadpago='Pentamestral' then  5
		when modalidadpago='Semestral' then 6
		when modalidadpago='Septamestral' then 7
		when modalidadpago='Octamestral' then 8
		when modalidadpago='Nonamestral' then 9
		when modalidadpago='Decamestral' then 10
		when modalidadpago='Anual' then  12
		end) mesespago
		from m_cli_credito_aprobado
		--where upper(formadeextincion) like '%VIGENTE%'
	) mcca
		on (trim(mcca.numerocredito)=trim(xpp.numero_credito))
UNION
SELECT  --para aquellos creditos que solo tienen una cuota a pagar
	'insert into m_cli_detalle_liquidacion_cuota (m_cli_liquidacion_cuotaid,m_cli_credito_aprobadoid,
numerocuota,inicioliquidacion,
finliquidacion,fechapago,
saldoanteriorcredito,valorcuota,
saldoanteriorcapital,capitalperiodo,saldoactualcapital,
saldoanteriorcorrientes,diasinterescorriente,porcentajecorriente,interescorrienteperiodo,saldoactualcorriente,
saldoanteriormoratorios,diasmora,interesmoratorioperiodo,porcentajemora,saldoactualmoratorios,cuotaseguro,
saldoactualseguro,saldonuevocredito,creacion,saldoanteriorseguro,abonocapital,abonocorriente,abonomoratorios,
abonoseguro) values ('||
	mclc.id||','||
	mcca.id ||',"'||
	xpp.cuota ||'","'||
	To_char(xpp.fecha_vencimiento  -(to_char(mcca.mesespago,'99')||'month') ::interval , 'yyyy-mm-dd')||'","'||
	xpp.fecha_vencimiento||'","'||
	To_char(date_trunc('month',xpp.fecha_vencimiento )  +'1month' ::interval -'1sec' ::interval, 'yyyy-mm-dd')||'",'||
	0||','||--saldoanteriorcredito
	coalesce(xpp.valor_capital,0) + coalesce(xpp.valor_interes,0) ||','||--valorcuota
	0 ||','||--saldoanteriorcapital
	coalesce(xpp.valor_capital,0) ||','||--capitalperiodo
	coalesce(xpp.valor_capital,0) ||','||--saldoactualcapital
	0 ||',"'||--saldoanteriorcorrientes
	xpp.pago_interes	      ||'",'||--diasinterescorriente
	coalesce(xpp.tasa_periodo,0)  ||','||--porcentajecorriente
	coalesce(xpp.valor_interes,0) ||','||--interescorrienteperiodo
	0 ||','|| --saldoactualcorriente
	0 ||','|| --Saldo anterior moratorio , tabla diana
	0 ||','|| --diasmora
	0 ||','|| --interesmoratorioperiodo
	0 ||','|| --porcentajemora
	0 ||','|| --saldoactualmoratorios
	coalesce(valor_seguro,0)     ||','|| --cuotaseguro
	0||','|| --saldoactualseguro
	0 ||',"'|| --saldonuevocredito
	'01-01-2017'||'",'|| --creacion
	0 || ','|| -- saldoanteriorseguro
	0 ||','|| --abonocapital
	0 ||','|| --abonocorriente
	0 ||','|| --abonomoratorios
	0 ||');' --abonoseguro
from
	xeo_plandepagos xpp
inner join 
	(
	SELECT NUMERO_COLOCACION,COUNT(COALESCE(CUOTA,'0'))
		FROM XEO_HISTORICO
		--WHERE numero_colocacion not in ('LIB-0002395','LIB-0002463','LIB-0002465','LIB-0002470','LIB-0002763')
		GROUP BY NUMERO_COLOCACION
		HAVING COUNT(COALESCE(CUOTA,'0'))=1
	
	) xh
		on (xh.numero_colocacion = xpp.numero_credito )
inner join 
	(select 
	substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
	from m_cli_liquidacion_cuota) mclc
		on (trim(xpp.numero_credito) = trim(mclc.credito))
inner join 
	(select id,numerocredito,
		(case
		when modalidadpago='Mensual' then 1
		when modalidadpago='Bimestral' then 2
		when modalidadpago='Trimestral' then  3
		when modalidadpago='Cuatrimestral' then  4
		when modalidadpago='Pentamestral' then  5
		when modalidadpago='Semestral' then 6
		when modalidadpago='Septamestral' then 7
		when modalidadpago='Octamestral' then 8
		when modalidadpago='Nonamestral' then 9
		when modalidadpago='Decamestral' then 10
		when modalidadpago='Anual' then  12
		end) mesespago
		from m_cli_credito_aprobado
		--where upper(formadeextincion) like '%VIGENTE%'
	) mcca
		on (trim(mcca.numerocredito)=trim(xpp.numero_credito))
UNION
SELECT --Solo los creditos que tienen cuota cero y que ya tienen un movimiento en historico; los que son nuevos se crean en otro select
	--adicionalmente el saldo del interes es cero por que se le descuenta total del credito.
	'insert into m_cli_detalle_liquidacion_cuota (m_cli_liquidacion_cuotaid,m_cli_credito_aprobadoid,
numerocuota,inicioliquidacion,
finliquidacion,fechapago,
saldoanteriorcredito,valorcuota,
saldoanteriorcapital,capitalperiodo,saldoactualcapital,
saldoanteriorcorrientes,diasinterescorriente,porcentajecorriente,interescorrienteperiodo,saldoactualcorriente,
saldoanteriormoratorios,diasmora,interesmoratorioperiodo,porcentajemora,saldoactualmoratorios,cuotaseguro,
saldoactualseguro,saldonuevocredito,creacion,saldoanteriorseguro,abonocapital,abonocorriente,abonomoratorios,
abonoseguro) values ('||mclc.id||','||--m_cli_liquidacion_cuotaid
	mcca.id ||',"'||--m_cli_credito_aprobadoid
	xpp.cuota ||'","'||--numerocuota
	To_char(xpp.fecha_vencimiento  -(to_char(mcca.mesespago,'99')||'month') ::interval , 'yyyy-mm-dd')||'","'||--inicioliquidacion
	xpp.fecha_vencimiento||'","'||--finliquidacion
	To_char(date_trunc('month',xpp.fecha_vencimiento )  +'1month' ::interval -'1sec' ::interval, 'yyyy-mm-dd')||'",'||--fechapago
	0 ||','||--saldoanteriorcredito
	coalesce(xpp.valor_capital,0)+coalesce(xpp.valor_interes,0)||','||--valorcuota
	0 ||','||--saldoanteriorcapital
	coalesce(xpp.valor_capital,0) ||','||--capitalperiodo
	coalesce(xpp.valor_capital,0)-0 ||','||--coalesce(xpp.valor_capital,0)-coalesce(xh.deuda,0) ||','||--saldoactualcapital
	0||',"'||--saldoanteriorcorrientes
	xpp.pago_interes||'",'||--diasinterescorriente
	coalesce(xpp.tasa_periodo,0) ||','||--porcentajecorriente
	coalesce(xpp.valor_interes,0) ||','||--interescorrienteperiodo
	0 ||','||--saldoactualcorriente 
	0 ||','||--Saldo anterior moratorio , tabla diana
	0 ||','||--dias mora, tabla diana
	0 ||','||--interesmoratorioperiodo
	0 ||','||--porcentajemora
	0 ||','||--saldoactualmoratorios
	0 ||','||--cuotaseguro
	0 ||','||--saldoactualseguro
	0 ||',"'|| --saldonuevocredito
	'01-01-2017'||'",'||--creacion
	0 || ','||--saldoanteriorseguro
	0 ||','||--abonocapital
	0 ||','||--abonocorriente
	0 ||','||--abonomoratorios
	0 ||');'--abonoseguro
from 	
	xeo_plandepagos xpp
inner join 
	(select 
	substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
	from m_cli_liquidacion_cuota) mclc
		on (trim(xpp.numero_credito) = trim(mclc.credito))
inner join 
	(select id,numerocredito,
		(case
		when modalidadpago='Mensual' then 1
		when modalidadpago='Bimestral' then 2
		when modalidadpago='Trimestral' then  3
		when modalidadpago='Cuatrimestral' then  4
		when modalidadpago='Pentamestral' then  5
		when modalidadpago='Semestral' then 6
		when modalidadpago='Septamestral' then 7
		when modalidadpago='Octamestral' then 8
		when modalidadpago='Nonamestral' then 9
		when modalidadpago='Decamestral' then 10
		when modalidadpago='Anual' then  12
		end) mesespago
		from m_cli_credito_aprobado
		--where upper(formadeextincion) like '%VIGENTE%'
	) mcca
		on (trim(mcca.numerocredito)=trim(xpp.numero_credito))

where mcca.numerocredito IN (
'CAR-070','CAR-080','CAR-081','CAR-082','CAR-083','CAR-084','CAR-085','CAR-086','CAR-087','CAR-088','CAR-089','CAR-090',
'CAR-091','CAR-092','CAR-093','CAR-094','CAR-095','CAR-096','CAR-097','CAR-098','CAR-099','CAR-100','CAR-101','CAR-102',
'CAR-103','CAR-104','CAR-105.','CAR-106','CAR-107','CAR-108','CAR-109','CAR-110','CAR-111','CAR-112','CAR-113','CAR-114',
'CAR-115','CAR-116','CAR-117','CAR-118','CAR-119','CAR-120','CAR-121','CAR-122','CAR-123','CAR-124','CAR-125','CAR-126.',
'CAR-127.','CAR-128','CAR-129','CAR-130.','CAR-131','CAR-132','CAR-133','CAR-134','CAR-135','CAR-136-','CAR-137*',
'CAR-138','CAR-139','CAR-140','CAR-141','CAR-142','CAR-143','CAR-144*','CAR-145','CAR-146','CAR-147','CAR-148','CAR-149',
'CAR-150','CAR-151','CAR-152','CAR-153','CAR-154','CAR-155','CAR-156','CAR-157','CAR-158','CAR-159','CAR-160','CAR-161*',
'CAR-162','CAR-163','CAR-164','CAR-165***','CAR-166','CAR-167','CAR-168','CAR-169','CAR-170','CAR-171*','CAR-172','CAR-173',
'CAR-174*','CAR-175','CAR-176','CAR-177','CAR-178','CAR-179-','CAR-181','CAR-182','CAR-183','CAR-185','CAR-186','CAR-187',
'CAR-188*','CAR-189','CAR-191','FAC-101','FAC-102','FAC-103','FAC-104','FAC-105','FAC-106*','FAC-107','FAC-108','FAC-109')
AND CAST(COALESCE(xpp.cuota,'0') AS INTEGER)=0

//***************************************************************************************************************************
//***************************************************************************************************************************
// Esto es solo para los creditos que se encuentran cancelados o creditos que no tienen ningun negativo en sus registros o que no se
// encuentran en mora.
//***************************************************************************************************************************
//***************************************************************************************************************************

update  M_CLI_DETALLE_LIQUIDACION_CUOTA set 
	saldoactualcapital=0,saldoactualcorriente=0,saldoactualseguro=0,saldoactualmoratorios=0;

update  M_CLI_DETALLE_LIQUIDACION_CUOTA set 
	saldoactualcapital=0,saldoactualcorriente=0,saldoactualseguro=0,saldoactualmoratorios=0
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and ( formadeextincion='Pagado');

update  M_CLI_DETALLE_LIQUIDACION_CUOTA set 
	saldoactualcapital=0,saldoactualcorriente=0,saldoactualseguro=0,saldoactualmoratorios=0
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and (numerocredito in 
('2006-02-335','2008-02-396','2008-02-397','2013-02-496',
'2014-02-511*','2015-02-518','2016-01-539','2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525','LIB-0001650','LIB-0001657','LIB-0001676',
'LIB-0001698',
'LIB-0001699','LIB-0001714','LIB-0001716','LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802','LIB-0001848','LIB-0001852',
'LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876','LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912',
'LIB-0001913','LIB-0001914','LIB-0001919*','LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945',
'LIB-0001946','LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970','LIB-0001972',
'LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020','LIB-0002022','LIB-0002023','LIB-0002024',
'LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035','LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050',
'LIB-0002060','LIB-0002069','LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112','LIB-0002113','LIB-0002114',
'LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126','LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137',
'LIB-0002138','LIB-0002144','LIB-0002147','LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169',
'LIB-0002170','LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197','LIB-0002199',
'LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211','LIB-0002215','LIB-0002217','LIB-0002218',
'LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228','LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242',
'LIB-0002248','LIB-0002252','LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272','LIB-0002282','LIB-0002286',
'LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292','LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301',
'LIB-0002306','LIB-0002309','LIB-0002311','LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335',
'LIB-0002336','LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343','LIB-0002344',
'LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370','LIB-0002371','LIB-0002372','LIB-0002373',
'LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387','LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394',
'LIB-0002395','LIB-0002396','LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422','LIB-0002423','LIB-0002424',
'LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434','LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439',
'LIB-0002446','LIB-0002447','LIB-0002448','LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456',
'LIB-0002458','LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467','LIB-0002468',
'LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474','LIB-0002475','LIB-0002476','LIB-0002478',
'LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484','LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494',
'LIB-0002495','LIB-0002499','LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526','LIB-0002527','LIB-0002528',
'LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647','LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659',
'LIB-0002663','LIB-0002664','LIB-0002666','LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681',
'LIB-0002682','LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693','LIB-0002694',
'LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700','LIB-0002705','LIB-0002706','LIB-0002707',
'LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711','LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716',
'LIB-0002717','LIB-0002718','LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738','LIB-0002739','LIB-0002740',
'LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750','LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757',
'LIB-0002758','LIB-0002759','LIB-0002760','LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770',
'LIB-0002771','LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779','LIB-0002780',
'LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788','LIB-0002789','LIB-0002790','LIB-0002791',
'LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795','LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801',
'LIB-0002804','LIB-0002805','LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820','LIB-0002821','LIB-0002822',
'LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827','LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831',
'LIB-0002832','LIB-0002833','LIB-0002835','LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841',
'LIB-0002842','LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849','LIB-0002850',
'LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857','LIB-0002858','LIB-0002859','LIB-0002860',
'LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864','LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869',
'LIB-0002870','LIB-0002871','LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885','LIB-0002886','LIB-0002887',
'LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894','LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898',
'LIB-0002899','LIB-0002900','LIB-0002901','LIB-001926')
);
	
update	m_cli_detalle_liquidacion_cuota 
set 	saldoactualcapital = coalesce(capitalperiodo,0)-coalesce(abonocapital,0) 
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and ( formadeextincion='Pagado' or numerocredito in 
('2006-02-335','2008-02-396','2008-02-397','2013-02-496',
'2014-02-511*','2015-02-518','2016-01-539','2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525','LIB-0001650','LIB-0001657','LIB-0001676',
'LIB-0001698',
'LIB-0001699','LIB-0001714','LIB-0001716','LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802','LIB-0001848','LIB-0001852',
'LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876','LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912',
'LIB-0001913','LIB-0001914','LIB-0001919*','LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945',
'LIB-0001946','LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970','LIB-0001972',
'LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020','LIB-0002022','LIB-0002023','LIB-0002024',
'LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035','LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050',
'LIB-0002060','LIB-0002069','LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112','LIB-0002113','LIB-0002114',
'LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126','LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137',
'LIB-0002138','LIB-0002144','LIB-0002147','LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169',
'LIB-0002170','LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197','LIB-0002199',
'LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211','LIB-0002215','LIB-0002217','LIB-0002218',
'LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228','LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242',
'LIB-0002248','LIB-0002252','LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272','LIB-0002282','LIB-0002286',
'LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292','LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301',
'LIB-0002306','LIB-0002309','LIB-0002311','LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335',
'LIB-0002336','LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343','LIB-0002344',
'LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370','LIB-0002371','LIB-0002372','LIB-0002373',
'LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387','LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394',
'LIB-0002395','LIB-0002396','LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422','LIB-0002423','LIB-0002424',
'LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434','LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439',
'LIB-0002446','LIB-0002447','LIB-0002448','LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456',
'LIB-0002458','LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467','LIB-0002468',
'LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474','LIB-0002475','LIB-0002476','LIB-0002478',
'LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484','LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494',
'LIB-0002495','LIB-0002499','LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526','LIB-0002527','LIB-0002528',
'LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647','LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659',
'LIB-0002663','LIB-0002664','LIB-0002666','LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681',
'LIB-0002682','LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693','LIB-0002694',
'LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700','LIB-0002705','LIB-0002706','LIB-0002707',
'LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711','LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716',
'LIB-0002717','LIB-0002718','LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738','LIB-0002739','LIB-0002740',
'LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750','LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757',
'LIB-0002758','LIB-0002759','LIB-0002760','LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770',
'LIB-0002771','LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779','LIB-0002780',
'LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788','LIB-0002789','LIB-0002790','LIB-0002791',
'LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795','LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801',
'LIB-0002804','LIB-0002805','LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820','LIB-0002821','LIB-0002822',
'LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827','LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831',
'LIB-0002832','LIB-0002833','LIB-0002835','LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841',
'LIB-0002842','LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849','LIB-0002850',
'LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857','LIB-0002858','LIB-0002859','LIB-0002860',
'LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864','LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869',
'LIB-0002870','LIB-0002871','LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885','LIB-0002886','LIB-0002887',
'LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894','LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898',
'LIB-0002899','LIB-0002900','LIB-0002901','LIB-001926')
);

update 	m_cli_detalle_liquidacion_cuota 
set 	saldoactualcorriente = coalesce(INTERESCORRIENTEPERIODO,0) -coalesce(ABONOCORRIENTE,0) 
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and ( formadeextincion='Pagado' or numerocredito in 
('2006-02-335','2008-02-396','2008-02-397','2013-02-496',
'2014-02-511*','2015-02-518','2016-01-539','2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525','LIB-0001650','LIB-0001657','LIB-0001676',
'LIB-0001698',
'LIB-0001699','LIB-0001714','LIB-0001716','LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802','LIB-0001848','LIB-0001852',
'LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876','LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912',
'LIB-0001913','LIB-0001914','LIB-0001919*','LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945',
'LIB-0001946','LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970','LIB-0001972',
'LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020','LIB-0002022','LIB-0002023','LIB-0002024',
'LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035','LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050',
'LIB-0002060','LIB-0002069','LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112','LIB-0002113','LIB-0002114',
'LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126','LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137',
'LIB-0002138','LIB-0002144','LIB-0002147','LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169',
'LIB-0002170','LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197','LIB-0002199',
'LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211','LIB-0002215','LIB-0002217','LIB-0002218',
'LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228','LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242',
'LIB-0002248','LIB-0002252','LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272','LIB-0002282','LIB-0002286',
'LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292','LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301',
'LIB-0002306','LIB-0002309','LIB-0002311','LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335',
'LIB-0002336','LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343','LIB-0002344',
'LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370','LIB-0002371','LIB-0002372','LIB-0002373',
'LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387','LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394',
'LIB-0002395','LIB-0002396','LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422','LIB-0002423','LIB-0002424',
'LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434','LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439',
'LIB-0002446','LIB-0002447','LIB-0002448','LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456',
'LIB-0002458','LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467','LIB-0002468',
'LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474','LIB-0002475','LIB-0002476','LIB-0002478',
'LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484','LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494',
'LIB-0002495','LIB-0002499','LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526','LIB-0002527','LIB-0002528',
'LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647','LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659',
'LIB-0002663','LIB-0002664','LIB-0002666','LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681',
'LIB-0002682','LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693','LIB-0002694',
'LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700','LIB-0002705','LIB-0002706','LIB-0002707',
'LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711','LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716',
'LIB-0002717','LIB-0002718','LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738','LIB-0002739','LIB-0002740',
'LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750','LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757',
'LIB-0002758','LIB-0002759','LIB-0002760','LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770',
'LIB-0002771','LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779','LIB-0002780',
'LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788','LIB-0002789','LIB-0002790','LIB-0002791',
'LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795','LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801',
'LIB-0002804','LIB-0002805','LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820','LIB-0002821','LIB-0002822',
'LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827','LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831',
'LIB-0002832','LIB-0002833','LIB-0002835','LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841',
'LIB-0002842','LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849','LIB-0002850',
'LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857','LIB-0002858','LIB-0002859','LIB-0002860',
'LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864','LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869',
'LIB-0002870','LIB-0002871','LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885','LIB-0002886','LIB-0002887',
'LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894','LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898',
'LIB-0002899','LIB-0002900','LIB-0002901','LIB-001926')
);

update 	m_cli_detalle_liquidacion_cuota 
set 	saldoactualmoratorios = coalesce(interesmoratorioperiodo,0) - coalesce(abonomoratorios,0) 
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and ( formadeextincion='Pagado' or numerocredito in 
('2006-02-335','2008-02-396','2008-02-397','2013-02-496',
'2014-02-511*','2015-02-518','2016-01-539','2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525','LIB-0001650','LIB-0001657','LIB-0001676',
'LIB-0001698',
'LIB-0001699','LIB-0001714','LIB-0001716','LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802','LIB-0001848','LIB-0001852',
'LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876','LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912',
'LIB-0001913','LIB-0001914','LIB-0001919*','LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945',
'LIB-0001946','LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970','LIB-0001972',
'LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020','LIB-0002022','LIB-0002023','LIB-0002024',
'LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035','LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050',
'LIB-0002060','LIB-0002069','LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112','LIB-0002113','LIB-0002114',
'LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126','LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137',
'LIB-0002138','LIB-0002144','LIB-0002147','LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169',
'LIB-0002170','LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197','LIB-0002199',
'LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211','LIB-0002215','LIB-0002217','LIB-0002218',
'LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228','LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242',
'LIB-0002248','LIB-0002252','LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272','LIB-0002282','LIB-0002286',
'LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292','LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301',
'LIB-0002306','LIB-0002309','LIB-0002311','LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335',
'LIB-0002336','LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343','LIB-0002344',
'LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370','LIB-0002371','LIB-0002372','LIB-0002373',
'LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387','LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394',
'LIB-0002395','LIB-0002396','LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422','LIB-0002423','LIB-0002424',
'LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434','LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439',
'LIB-0002446','LIB-0002447','LIB-0002448','LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456',
'LIB-0002458','LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467','LIB-0002468',
'LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474','LIB-0002475','LIB-0002476','LIB-0002478',
'LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484','LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494',
'LIB-0002495','LIB-0002499','LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526','LIB-0002527','LIB-0002528',
'LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647','LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659',
'LIB-0002663','LIB-0002664','LIB-0002666','LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681',
'LIB-0002682','LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693','LIB-0002694',
'LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700','LIB-0002705','LIB-0002706','LIB-0002707',
'LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711','LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716',
'LIB-0002717','LIB-0002718','LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738','LIB-0002739','LIB-0002740',
'LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750','LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757',
'LIB-0002758','LIB-0002759','LIB-0002760','LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770',
'LIB-0002771','LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779','LIB-0002780',
'LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788','LIB-0002789','LIB-0002790','LIB-0002791',
'LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795','LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801',
'LIB-0002804','LIB-0002805','LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820','LIB-0002821','LIB-0002822',
'LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827','LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831',
'LIB-0002832','LIB-0002833','LIB-0002835','LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841',
'LIB-0002842','LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849','LIB-0002850',
'LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857','LIB-0002858','LIB-0002859','LIB-0002860',
'LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864','LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869',
'LIB-0002870','LIB-0002871','LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885','LIB-0002886','LIB-0002887',
'LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894','LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898',
'LIB-0002899','LIB-0002900','LIB-0002901','LIB-001926')
);
	
update 	m_cli_detalle_liquidacion_cuota 
set 	saldoactualseguro = coalesce(cuotaseguro,0) - coalesce(ABONOSEGURO,0)
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and ( formadeextincion='Pagado' or numerocredito in 
('2006-02-335','2008-02-396','2008-02-397','2013-02-496',
'2014-02-511*','2015-02-518','2016-01-539','2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525','LIB-0001650','LIB-0001657','LIB-0001676',
'LIB-0001698',
'LIB-0001699','LIB-0001714','LIB-0001716','LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802','LIB-0001848','LIB-0001852',
'LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876','LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912',
'LIB-0001913','LIB-0001914','LIB-0001919*','LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945',
'LIB-0001946','LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970','LIB-0001972',
'LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020','LIB-0002022','LIB-0002023','LIB-0002024',
'LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035','LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050',
'LIB-0002060','LIB-0002069','LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112','LIB-0002113','LIB-0002114',
'LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126','LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137',
'LIB-0002138','LIB-0002144','LIB-0002147','LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169',
'LIB-0002170','LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197','LIB-0002199',
'LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211','LIB-0002215','LIB-0002217','LIB-0002218',
'LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228','LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242',
'LIB-0002248','LIB-0002252','LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272','LIB-0002282','LIB-0002286',
'LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292','LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301',
'LIB-0002306','LIB-0002309','LIB-0002311','LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335',
'LIB-0002336','LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343','LIB-0002344',
'LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370','LIB-0002371','LIB-0002372','LIB-0002373',
'LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387','LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394',
'LIB-0002395','LIB-0002396','LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422','LIB-0002423','LIB-0002424',
'LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434','LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439',
'LIB-0002446','LIB-0002447','LIB-0002448','LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456',
'LIB-0002458','LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467','LIB-0002468',
'LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474','LIB-0002475','LIB-0002476','LIB-0002478',
'LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484','LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494',
'LIB-0002495','LIB-0002499','LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526','LIB-0002527','LIB-0002528',
'LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647','LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659',
'LIB-0002663','LIB-0002664','LIB-0002666','LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681',
'LIB-0002682','LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693','LIB-0002694',
'LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700','LIB-0002705','LIB-0002706','LIB-0002707',
'LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711','LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716',
'LIB-0002717','LIB-0002718','LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738','LIB-0002739','LIB-0002740',
'LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750','LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757',
'LIB-0002758','LIB-0002759','LIB-0002760','LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770',
'LIB-0002771','LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779','LIB-0002780',
'LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788','LIB-0002789','LIB-0002790','LIB-0002791',
'LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795','LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801',
'LIB-0002804','LIB-0002805','LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820','LIB-0002821','LIB-0002822',
'LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827','LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831',
'LIB-0002832','LIB-0002833','LIB-0002835','LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841',
'LIB-0002842','LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849','LIB-0002850',
'LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857','LIB-0002858','LIB-0002859','LIB-0002860',
'LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864','LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869',
'LIB-0002870','LIB-0002871','LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885','LIB-0002886','LIB-0002887',
'LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894','LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898',
'LIB-0002899','LIB-0002900','LIB-0002901','LIB-001926')
);

	
update 	m_cli_detalle_liquidacion_cuota */
set 	saldonuevocredito = coalesce(saldoactualcapital,0) 	+ 
						coalesce(saldoactualcorriente,0) 			+ 
						coalesce(saldoactualmoratorios,0) + 
						coalesce(saldoactualseguro,0) 
from  m_cli_credito_aprobado
where m_cli_credito_aprobado.id=M_CLI_DETALLE_LIQUIDACION_CUOTA.m_cli_credito_aprobadoid
and ( formadeextincion='Pagado' or numerocredito in 
('2006-02-335','2008-02-396','2008-02-397','2013-02-496',
'2014-02-511*','2015-02-518','2016-01-539','2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525','LIB-0001650','LIB-0001657','LIB-0001676',
'LIB-0001698',
'LIB-0001699','LIB-0001714','LIB-0001716','LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802','LIB-0001848','LIB-0001852',
'LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876','LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912',
'LIB-0001913','LIB-0001914','LIB-0001919*','LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945',
'LIB-0001946','LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970','LIB-0001972',
'LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020','LIB-0002022','LIB-0002023','LIB-0002024',
'LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035','LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050',
'LIB-0002060','LIB-0002069','LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112','LIB-0002113','LIB-0002114',
'LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126','LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137',
'LIB-0002138','LIB-0002144','LIB-0002147','LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169',
'LIB-0002170','LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197','LIB-0002199',
'LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211','LIB-0002215','LIB-0002217','LIB-0002218',
'LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228','LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242',
'LIB-0002248','LIB-0002252','LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272','LIB-0002282','LIB-0002286',
'LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292','LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301',
'LIB-0002306','LIB-0002309','LIB-0002311','LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335',
'LIB-0002336','LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343','LIB-0002344',
'LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370','LIB-0002371','LIB-0002372','LIB-0002373',
'LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387','LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394',
'LIB-0002395','LIB-0002396','LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422','LIB-0002423','LIB-0002424',
'LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434','LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439',
'LIB-0002446','LIB-0002447','LIB-0002448','LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456',
'LIB-0002458','LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467','LIB-0002468',
'LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474','LIB-0002475','LIB-0002476','LIB-0002478',
'LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484','LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494',
'LIB-0002495','LIB-0002499','LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526','LIB-0002527','LIB-0002528',
'LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647','LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659',
'LIB-0002663','LIB-0002664','LIB-0002666','LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681',
'LIB-0002682','LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693','LIB-0002694',
'LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700','LIB-0002705','LIB-0002706','LIB-0002707',
'LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711','LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716',
'LIB-0002717','LIB-0002718','LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738','LIB-0002739','LIB-0002740',
'LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750','LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757',
'LIB-0002758','LIB-0002759','LIB-0002760','LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770',
'LIB-0002771','LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779','LIB-0002780',
'LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788','LIB-0002789','LIB-0002790','LIB-0002791',
'LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795','LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801',
'LIB-0002804','LIB-0002805','LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820','LIB-0002821','LIB-0002822',
'LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827','LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831',
'LIB-0002832','LIB-0002833','LIB-0002835','LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841',
'LIB-0002842','LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849','LIB-0002850',
'LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857','LIB-0002858','LIB-0002859','LIB-0002860',
'LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864','LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869',
'LIB-0002870','LIB-0002871','LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885','LIB-0002886','LIB-0002887',
'LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894','LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898',
'LIB-0002899','LIB-0002900','LIB-0002901','LIB-001926')
);
						

//////******************************
//////***************************************
//////******************************************** 

Este proceso es para los que tienen MORA.

Ejecutar los archivos de TOTAL - MORA (correo electrónico).

 
//////*********************************************
//////***************************************
//////******************************

UPDATE M_CLI_DETALLE_LIQUIDACION_CUOTA MCDLC */
SET 
	porcentajemora=((32.985/100)/360)*diasmora
FROM M_CLI_LIQUIDACION_CUOTA MCLC
WHERE MCLC.ID=MCDLC.M_CLI_LIQUIDACION_CUOTAID 
--AND mcdlc.NUMEROCUOTA=
--AND substring(MCLC.descripcion from position ('Num.Credito:' in MCLC.descripcion)+12 for char_length(MCLC.descripcion)) = '2006-02-335'

UPDATE M_CLI_DETALLE_LIQUIDACION_CUOTA MCDLC */
SET 
	interesmoratorioperiodo=ROUND(((32.985/100)/360)*diasmora*saldoactualcapital)
FROM M_CLI_LIQUIDACION_CUOTA MCLC
WHERE MCLC.ID=MCDLC.M_CLI_LIQUIDACION_CUOTAID 


---------------------------------------------------					
----m_cli_detalle_liquidacion_cuota saldos actuales
---------------------------------------------------
	
update	m_cli_detalle_liquidacion_cuota 
set 	saldoactualcapital = coalesce(capitalperiodo,0)-coalesce(abonocapital,0) ;

update 	m_cli_detalle_liquidacion_cuota 
set 	saldoactualcorriente = coalesce(INTERESCORRIENTEPERIODO,0) -coalesce(ABONOCORRIENTE,0) ;

update 	m_cli_detalle_liquidacion_cuota 
set 	saldoactualmoratorios = coalesce(interesmoratorioperiodo,0) - coalesce(abonomoratorios,0) ;
	
update 	m_cli_detalle_liquidacion_cuota 
set 	saldoactualseguro = coalesce(cuotaseguro,0) - coalesce(ABONOSEGURO,0);

	
update 	m_cli_detalle_liquidacion_cuota */
set 	saldonuevocredito = coalesce(saldoactualcapital,0) 	+ 
						coalesce(saldoactualcorriente,0) 			+ 
						coalesce(saldoactualmoratorios,0) + 
						coalesce(saldoactualseguro,0) ;
						

-------------------------------------------------------------------------
----m_cli_detalle_comprobante_credito	con detalle liquidacion cuota 					
-------------------------------------------------------------------------

select 
'insert into m_cli_detalle_comprobante_credito 
(m_cli_comprobante_creditoid,m_cli_credito_aprobadoid,creacion,m_cli_detalle_liquidacion_cuotaid,descripcion,valor) values ('||
mccc.id||','||mcca.id||',"'||'01-01-2017'||'",'||mcdlc.id||',"'||mccc.descripcion||'",'||xh.valor||');'
from
(select numero_colocacion,fecha_movimiento,cuota,sum(coalesce(valor_transaccion,0)) valor
from xeo_historico
where cuota is not null
group by 1,2,3) xh

inner join 
	(select id,numerocredito
		from m_cli_credito_aprobado
		where ( formadeextincion='Pagado' or numerocredito in 
			('2006-02-335','2008-02-396','2008-02-397','2013-02-496','2014-02-511*','2015-02-518','2016-01-539',
			'2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
			'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525',
			'LIB-0001650','LIB-0001657','LIB-0001676','LIB-0001698','LIB-0001699','LIB-0001714','LIB-0001716',
			'LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
			'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802',
			'LIB-0001848','LIB-0001852','LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876',
			'LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912','LIB-0001913','LIB-0001914','LIB-0001919*',
			'LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945','LIB-0001946',
			'LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970',
			'LIB-0001972','LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020',
			'LIB-0002022','LIB-0002023','LIB-0002024','LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035',
			'LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050','LIB-0002060','LIB-0002069',
			'LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
			'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112',
			'LIB-0002113','LIB-0002114','LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126',
			'LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137','LIB-0002138','LIB-0002144','LIB-0002147',
			'LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169','LIB-0002170',
			'LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197',
			'LIB-0002199','LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211',
			'LIB-0002215','LIB-0002217','LIB-0002218','LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228',
			'LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242','LIB-0002248','LIB-0002252',
			'LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
			'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272',
			'LIB-0002282','LIB-0002286','LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292',
			'LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301','LIB-0002306','LIB-0002309','LIB-0002311',
			'LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335','LIB-0002336',
			'LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343',
			'LIB-0002344','LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370',
			'LIB-0002371','LIB-0002372','LIB-0002373','LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387',
			'LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394','LIB-0002395','LIB-0002396',
			'LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
			'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422',
			'LIB-0002423','LIB-0002424','LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434',
			'LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439','LIB-0002446','LIB-0002447','LIB-0002448',
			'LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456','LIB-0002458',
			'LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467',
			'LIB-0002468','LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474',
			'LIB-0002475','LIB-0002476','LIB-0002478','LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484',
			'LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494','LIB-0002495','LIB-0002499',
			'LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
			'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526',
			'LIB-0002527','LIB-0002528','LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647',
			'LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659','LIB-0002663','LIB-0002664','LIB-0002666',
			'LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681','LIB-0002682',
			'LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693',
			'LIB-0002694','LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700',
			'LIB-0002705','LIB-0002706','LIB-0002707','LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711',
			'LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716','LIB-0002717','LIB-0002718',
			'LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
			'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738',
			'LIB-0002739','LIB-0002740','LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750',
			'LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757','LIB-0002758','LIB-0002759','LIB-0002760',
			'LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770','LIB-0002771',
			'LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779',
			'LIB-0002780','LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788',
			'LIB-0002789','LIB-0002790','LIB-0002791','LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795',
			'LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801','LIB-0002804','LIB-0002805',
			'LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
			'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820',
			'LIB-0002821','LIB-0002822','LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827',
			'LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831','LIB-0002832','LIB-0002833','LIB-0002835',
			'LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841','LIB-0002842',
			'LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849',
			'LIB-0002850','LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857',
			'LIB-0002858','LIB-0002859','LIB-0002860','LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864',
			'LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869','LIB-0002870','LIB-0002871',
			'LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
			'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885',
			'LIB-0002886','LIB-0002887','LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894',
			'LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898','LIB-0002899','LIB-0002900','LIB-0002901',
			'LIB-001926'))
	) mcca
		on (trim(mcca.numerocredito)=trim(xh.numero_colocacion) )

inner join 
	m_cli_detalle_liquidacion_cuota mcdlc
		on (mcdlc.m_cli_credito_aprobadoid=mcca.id) and (cast(xh.cuota as integer)=mcdlc.numerocuota)
					
inner join 
	(select 
	descripcion,substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id,
	fecha
	from m_cli_comprobante_credito) mccc
		on (trim(xh.numero_colocacion) = trim(mccc.credito) and (mccc.fecha=xh.fecha_movimiento))
					
---------------------------------------------------------------------------------------
----m_cli_detalle_comprobante_credito	con detalle liquidacion cuota igual a null					
---------------------------------------------------------------------------------------

select 
'insert into m_cli_detalle_comprobante_credito 
(m_cli_comprobante_creditoid,m_cli_credito_aprobadoid,creacion,m_cli_detalle_liquidacion_cuotaid,descripcion,valor)
values 
('||mccc.id||','||mcca.id||',"'||'01-01-2017'||'",null,"'||mccc.descripcion||'",'||xh.valor||');'
from
(select numero_colocacion,fecha_movimiento,cuota,sum(coalesce(valor_transaccion,0)) valor
from xeo_historico
where (upper(transaccion) not like ('%VIGENTE%') 
and upper(transaccion) not like ('%CANCELADO%'))
group by 1,2,3) xh
inner join 
	(select id,numerocredito
		from m_cli_credito_aprobado
		where upper(formadeextincion) like '%VIGENTE%'
	) mcca
		on (trim(mcca.numerocredito)=trim(xh.numero_colocacion) )
inner join 
	(select 
	descripcion,substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id,
	fecha
	from m_cli_comprobante_credito) mccc
		on (trim(xh.numero_colocacion) = trim(mccc.credito) and (mccc.fecha=xh.fecha_movimiento))
		



------------------------------------------------------------------------------------------------
----m_cli_kardex_credito los cred.que se encuentran sin negativos y los pagados
------------------------------------------------------------------------------------------------
select 
	--xpp2.numero_credito,xh.numero_colocacion,xpp2.cuota,
	'insert into m_cli_kardex_credito 
	(m_cli_detalle_comprobante_creditoid,
	s_tipo_documentoid,s_tipo_movimientoid,s_vigenciavigencia,s_periodoperiodo,
	fechatransaccion, 
	username,
	creacion,
	m_cli_credito_aprobadoid,
	acumuladocargocapital,
	acumuladoabonocapital,
	acumuladomoragenerada,
	acumuladoabonomora,
	acumuladocorrientegenerado,
	acumuladoabonocorriente,
	acumuladocuotaseguro,
	acumuladoabonoseguro,
	fecharealdepago,
	m_cli_detalle_liquidacion_cuotaid,
	valortransaccion,
	capitalperiodo,
	abonocapital,
	interescorrienteperiodo,
	abonocorriente,
	interesmoratorioperiodo,
	abonomoratorios,
	cuotaseguro,
	abonoseguro,
	estado) values ('||
	mcdcc.id||--m_cli_detalle_comprobante_creditoid
	',42,187,2017,1,"'||--s_tipo_documentoid,s_tipo_movimientoid,s_vigenciavigencia,s_periodoperiodo,	
	xh.fecha_movimiento||'","'||--fecha_transaccion
	'admin@siep.com'||'","'||--username
	'01-01-2017'||'",'||--creacion
	mcca.id||','||
	xh.valor_desembolso  ||','|| --coalesce(xh.interes_corriente,0)+coalesce(xh.seguro,0)+coalesce(xh.deuda,0)+coalesce(xh.mora,0) ||','||--acumulado cargo capital
	coalesce(xh.deuda,0)||','||--acumulado abono capital
	coalesce(mcdlc.saldoanteriormoratorios,0)||','||--xmora.valor_mora;tabla diana mora acumuladomoragenerada
	COALESCE(xh.mora,0)||','||--xmora.mora; acumuladoabonomora
	coalesce(xpp2.acumulado_interes,0)||','||--acumulado corriente gene
	coalesce(xh.interes_corriente,0)||','||--acumulado abono corriente
	coalesce(xpp2.acumulado_seguro,0)||','||--acumulado cuota seguro
	coalesce(xh.seguro,0)||',"'||--acumulado abono seguro
	xh.fecha_movimiento||'",'||--fecha_real_de pago
	mcdlc.id||','||--m_cli_detalle_liquidacion_cuotaid
	coalesce(xh.interes_corriente,0)+coalesce(xh.seguro,0)+coalesce(xh.deuda,0)+coalesce(xh.mora,0)||','||--valor_transaccion
	coalesce(xpp2.valor_capital,0)||','||--capitalperiodo
	coalesce(xh.deuda,0)||','||--abono capital
	coalesce(xpp2.valor_interes,0)||','||--interes corriente periodo
	coalesce(xh.interes_corriente,0)||','||--abono corriente
	coalesce(mcdlc.interesmoratorioperiodo,0)||','|| --interes moratorio periodo
	COALESCE(xh.mora,0)||','||--xmora.mora;abono moratorios
	coalesce(xpp2.valor_seguro,0)||','|| --cuota seguro
	coalesce(xh.Seguro,0)||',"'|| --abono seguro
	'Autorizado'||'");'--estado	
from 
	(select xpp.id,xpp.numero_credito,xpp.cuota,
		xpp.valor_cuota,
			(select sum(valor_cuota) 
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_cuota,
		xpp.valor_interes,
		(select sum(valor_interes)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_interes,
		xpp.valor_capital,
		(select sum(valor_capital)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_capital,
		xpp.valor_saldo,
		(select sum(valor_saldo)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_saldo,
		xpp.valor_seguro,
		(select sum(valor_seguro)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_seguro	
		from xeo_plandepagos xpp
		order by xpp.numero_credito,xpp.id
	) xpp2
inner join  (select xeoh.numero_colocacion,cuota,
		coalesce(xeoh2.valor_desembolso,0) valor_desembolso,
		fecha_movimiento,
		SUM(case
		when POSITION( 'Int.' IN transaccion)>0
			then coalesce(VALOR_TRANSACCION,0) end)interes_corriente,
		sum(case
		when POSITION( 'Seguro' IN transaccion)>0 
			then coalesce(valor_transaccion,0) end ) seguro,
		sum(case
		when POSITION( 'Deuda' IN transaccion)>0  
			then coalesce(valor_transaccion,0) end ) deuda,
		sum(case
		when POSITION( 'Mora' IN transaccion)>0  
			then coalesce(valor_transaccion,0) end ) mora,
		sum(saldo_capital) capital
		from xeo_historico xeoh
		inner join (select numero_colocacion,valor_desembolso
		 from xeo_historico
		 where cuota is null)xeoh2
		on ( xeoh2.numero_colocacion=xeoh.numero_colocacion )
		where cuota is not null --and xeoh.numero_colocacion='LIB-0002001'
		group by 1,2,3,4		
	) xh
	on (xh.numero_colocacion=xpp2.numero_credito and xh.cuota=xpp2.cuota)
		
inner join 
	(select 
	descripcion,substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id,
	fecha
	from m_cli_comprobante_credito) mccc
		on (trim(xh.numero_colocacion) = trim(mccc.credito) and (mccc.fecha=xh.fecha_movimiento))

inner join 
	(select id,numerocredito,
		(case
		when modalidadpago='Mensual' then 1
		when modalidadpago='Bimestral' then 2
		when modalidadpago='Trimestral' then  3
		when modalidadpago='Cuatrimestral' then  4
		when modalidadpago='Pentamestral' then  5
		when modalidadpago='Semestral' then 6
		when modalidadpago='Septamestral' then 7
		when modalidadpago='Octamestral' then 8
		when modalidadpago='Nonamestral' then 9
		when modalidadpago='Decamestral' then 10
		when modalidadpago='Anual' then  12
		end) mesespago
		from m_cli_credito_aprobado mcca
		where ( formadeextincion='Pagado' or numerocredito in 
			('2006-02-335','2008-02-396','2008-02-397','2013-02-496','2014-02-511*','2015-02-518','2016-01-539',
			'2017-02-540','2017-02-541','CAR-182','CAR-184','CAR-188*','CAR-189','CAR-190',
			'CAR-191','CAR-192','CAR-193','CAR-194','FAC-102','FAC-104','FAC-105','LIB-0001525',
			'LIB-0001650','LIB-0001657','LIB-0001676','LIB-0001698','LIB-0001699','LIB-0001714','LIB-0001716',
			'LIB-0001722','LIB-0001736','LIB-0001739','LIB-0001750','LIB-0001751','LIB-0001754',
			'LIB-0001760','LIB-0001761','LIB-0001767','LIB-0001775','LIB-0001784','LIB-0001797','LIB-0001802',
			'LIB-0001848','LIB-0001852','LIB-0001855','LIB-0001860','LIB-0001861','LIB-0001872','LIB-0001876',
			'LIB-0001884','LIB-0001885','LIB-0001892','LIB-0001912','LIB-0001913','LIB-0001914','LIB-0001919*',
			'LIB-0001920','LIB-0001921','LIB-0001923','LIB-0001927','LIB-0001932','LIB-0001945','LIB-0001946',
			'LIB-0001947','LIB-0001948','LIB-0001949','LIB-0001950','LIB-0001966','LIB-0001967','LIB-0001970',
			'LIB-0001972','LIB-0001994','LIB-0001995','LIB-0001998','LIB-0002000','LIB-0002012','LIB-0002020',
			'LIB-0002022','LIB-0002023','LIB-0002024','LIB-0002028','LIB-0002033','LIB-0002034','LIB-0002035',
			'LIB-0002036','LIB-0002037','LIB-000-2048','LIB-0002049','LIB-0002050','LIB-0002060','LIB-0002069',
			'LIB-0002070','LIB-0002072','LIB-0002073','LIB-0002083','LIB-0002084','LIB-0002085','LIB-0002087',
			'LIB-0002088','LIB-0002092','LIB-0002097','LIB-0002102','LIB-0002106','LIB-0002108','LIB-0002112',
			'LIB-0002113','LIB-0002114','LIB-0002117','LIB-0002120','LIB-0002124','LIB-0002125','LIB-0002126',
			'LIB-0002127','LIB-0002128','LIB-0002136','LIB-0002137','LIB-0002138','LIB-0002144','LIB-0002147',
			'LIB-0002153','LIB-0002156','LIB-0002157','LIB-0002165','LIB-0002168','LIB-0002169','LIB-0002170',
			'LIB-0002174','LIB-0002178','LIB-0002179','LIB-0002189','LIB-0002195','LIB-0002196','LIB-0002197',
			'LIB-0002199','LIB-0002202','LIB-0002205','LIB-0002206','LIB-0002207','LIB-0002208','LIB-0002211',
			'LIB-0002215','LIB-0002217','LIB-0002218','LIB-0002220','LIB-0002224','LIB-0002225','LIB-0002228',
			'LIB-0002231','LIB-0002233','LIB-0002237','LIB-0002240','LIB-0002242','LIB-0002248','LIB-0002252',
			'LIB-0002253','LIB-0002254','LIB-0002256','LIB-0002258','LIB-0002259','LIB-0002260','LIB-0002261',
			'LIB-0002263','LIB-0002265','LIB-0002266','LIB-0002267','LIB-0002269','LIB-0002270','LIB-0002272',
			'LIB-0002282','LIB-0002286','LIB-0002287','LIB-0002288','LIB-0002289','LIB-0002291','LIB-0002292',
			'LIB-0002293','LIB-0002294','LIB-0002300','LIB-0002301','LIB-0002306','LIB-0002309','LIB-0002311',
			'LIB-0002313','LIB-0002316','LIB-0002319','LIB-0002325','LIB-0002332','LIB-0002335','LIB-0002336',
			'LIB-0002337','LIB-0002338','LIB-0002339','LIB-0002340','LIB-0002341','LIB-0002342','LIB-0002343',
			'LIB-0002344','LIB-0002346','LIB-0002348','LIB-0002353','LIB-0002360','LIB-0002369','LIB-0002370',
			'LIB-0002371','LIB-0002372','LIB-0002373','LIB-0002381','LIB-0002382','LIB-0002384','LIB-0002387',
			'LIB-0002389','LIB-0002390','LIB-0002391','LIB-0002393','LIB-0002394','LIB-0002395','LIB-0002396',
			'LIB-0002398','LIB-0002399','LIB-0002401','LIB-0002402','LIB-0002403','LIB-0002404','LIB-0002406',
			'LIB-0002407','LIB-0002409','LIB-0002410','LIB-0002414','LIB-0002415','LIB-0002419','LIB-0002422',
			'LIB-0002423','LIB-0002424','LIB-0002427','LIB-0002428','LIB-0002429','LIB-0002433','LIB-0002434',
			'LIB-0002436','LIB-0002437','LIB-0002438','LIB-0002439','LIB-0002446','LIB-0002447','LIB-0002448',
			'LIB-0002449','LIB-0002451','LIB-0002453','LIB-0002454','LIB-0002455','LIB-0002456','LIB-0002458',
			'LIB-0002460','LIB-0002462','LIB-0002463','LIB-0002464','LIB-0002465','LIB-0002466','LIB-0002467',
			'LIB-0002468','LIB-0002469','LIB-0002470','LIB-0002471','LIB-0002472','LIB-0002473','LIB-0002474',
			'LIB-0002475','LIB-0002476','LIB-0002478','LIB-0002480','LIB-0002482','LIB-0002483','LIB-0002484',
			'LIB-0002486','LIB-0002488','LIB-0002489','LIB-0002490','LIB-0002494','LIB-0002495','LIB-0002499',
			'LIB-0002502','LIB-0002503','LIB-0002504','LIB-0002506','LIB-0002509','LIB-0002510','LIB-0002511',
			'LIB-0002512','LIB-0002517','LIB-0002518','LIB-0002520','LIB-0002522','LIB-0002524','LIB-0002526',
			'LIB-0002527','LIB-0002528','LIB-0002529','LIB-0002530','LIB-0002531','LIB-0002535','LIB-0002647',
			'LIB-0002650','LIB-0002651','LIB-0002653','LIB-0002659','LIB-0002663','LIB-0002664','LIB-0002666',
			'LIB-0002668','LIB-0002669','LIB-0002675','LIB-0002676','LIB-0002678','LIB-0002681','LIB-0002682',
			'LIB-0002683','LIB-0002684','LIB-0002685','LIB-0002689','LIB-0002690','LIB-0002692','LIB-0002693',
			'LIB-0002694','LIB-0002695','LIB-0002696','LIB-0002697','LIB-0002698','LIB-0002699','LIB-0002700',
			'LIB-0002705','LIB-0002706','LIB-0002707','LIB-0002708','LIB-0002709','LIB-0002710','LIB-0002711',
			'LIB-0002712','LIB-0002713','LIB-0002714','LIB-0002715','LIB-0002716','LIB-0002717','LIB-0002718',
			'LIB-0002719','LIB-0002720','LIB-0002721','LIB-0002722','LIB-0002723','LIB-0002724','LIB-0002729',
			'LIB-0002730','LIB-0002731','LIB-0002734','LIB-0002735','LIB-0002736','LIB-0002737','LIB-0002738',
			'LIB-0002739','LIB-0002740','LIB-0002741','LIB-0002747','LIB-0002748','LIB-0002749','LIB-0002750',
			'LIB-0002751','LIB-0002753','LIB-0002755','LIB-0002757','LIB-0002758','LIB-0002759','LIB-0002760',
			'LIB-0002761','LIB-0002766','LIB-0002767','LIB-0002768','LIB-0002769','LIB-0002770','LIB-0002771',
			'LIB-0002772','LIB-0002773','LIB-0002774','LIB-0002775','LIB-0002776','LIB-0002778','LIB-0002779',
			'LIB-0002780','LIB-0002781','LIB-0002782','LIB-0002785','LIB-0002786','LIB-0002787','LIB-0002788',
			'LIB-0002789','LIB-0002790','LIB-0002791','LIB-0002792','LIB-0002793','LIB-0002794','LIB-0002795',
			'LIB-0002796','LIB-0002797','LIB-0002798','LIB-0002799','LIB-0002801','LIB-0002804','LIB-0002805',
			'LIB-0002806','LIB-0002807','LIB-0002808','LIB-0002809','LIB-0002810','LIB-0002811','LIB-0002812',
			'LIB-0002813','LIB-0002814','LIB-0002815','LIB-0002816','LIB-0002817','LIB-0002819','LIB-0002820',
			'LIB-0002821','LIB-0002822','LIB-0002823','LIB-0002824','LIB-0002825','LIB-0002826','LIB-0002827',
			'LIB-0002828','LIB-0002829','LIB-0002830','LIB-0002831','LIB-0002832','LIB-0002833','LIB-0002835',
			'LIB-0002836','LIB-0002837','LIB-0002838','LIB-0002839','LIB-0002840','LIB-0002841','LIB-0002842',
			'LIB-0002843','LIB-0002844','LIB-0002845','LIB-0002846','LIB-0002847','LIB-0002848','LIB-0002849',
			'LIB-0002850','LIB-0002852','LIB-0002853','LIB-0002854','LIB-0002855','LIB-0002856','LIB-0002857',
			'LIB-0002858','LIB-0002859','LIB-0002860','LIB-0002861','LIB-0002862','LIB-0002863','LIB-0002864',
			'LIB-0002865','LIB-0002866','LIB-0002867','LIB-0002868','LIB-0002869','LIB-0002870','LIB-0002871',
			'LIB-0002872','LIB-0002873','LIB-0002874','LIB-0002875','LIB-0002876','LIB-0002877','LIB-0002878',
			'LIB-0002879','LIB-0002880','LIB-0002881','LIB-0002882','LIB-0002883','LIB-0002884','LIB-0002885',
			'LIB-0002886','LIB-0002887','LIB-0002888','LIB-0002890','LIB-0002892','LIB-0002893','LIB-0002894',
			'LIB-0002895','LIB-0002896','LIB-0002897','LIB-0002898','LIB-0002899','LIB-0002900','LIB-0002901',
			'LIB-001926'))
		
	) mcca
	on (trim(mcca.numerocredito)=trim(xpp2.numero_credito))	

inner join 
	(select 
		substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
		from m_cli_liquidacion_cuota) mclc
			on (trim(xpp2.numero_credito) = trim(mclc.credito))

inner join 
	m_cli_detalle_liquidacion_cuota mcdlc 
		on (mcdlc.m_cli_credito_aprobadoid=mcca.id) and (cast(xpp2.cuota as integer)=mcdlc.numerocuota)
		

inner join 
	m_cli_detalle_comprobante_credito mcdcc
		on (mcdcc.m_cli_comprobante_creditoid = mccc.id
			 and mcdcc.m_cli_credito_aprobadoid=mcca.id
			 and mcdcc.m_cli_detalle_liquidacion_cuotaid=mcdlc.id)
			 			 			 
---------------------------------------------------------------------
m_cli_kardex_credito para los cred que estan vigentes que tienen novedades

----------------------------------------------------------------------
select 
	--xpp2.numero_credito,xh.numero_colocacion,xpp2.cuota,
	'insert into m_cli_kardex_credito 
	(m_cli_detalle_comprobante_creditoid,
	s_tipo_documentoid,s_tipo_movimientoid,s_vigenciavigencia,s_periodoperiodo,
	fechatransaccion, 
	username,
	creacion,
	m_cli_credito_aprobadoid,
	acumuladocargocapital,
	acumuladoabonocapital,
	acumuladomoragenerada,
	acumuladoabonomora,
	acumuladocorrientegenerado,
	acumuladoabonocorriente,
	acumuladocuotaseguro,
	acumuladoabonoseguro,
	fecharealdepago,
	m_cli_detalle_liquidacion_cuotaid,
	valortransaccion,
	capitalperiodo,
	abonocapital,
	interescorrienteperiodo,
	abonocorriente,
	interesmoratorioperiodo,
	abonomoratorios,
	cuotaseguro,
	abonoseguro,
	estado) values ('||
	mcdcc.id||--m_cli_detalle_comprobante_creditoid
	',42,187,2017,1,"'||--s_tipo_documentoid,s_tipo_movimientoid,s_vigenciavigencia,s_periodoperiodo,	
	xh.fecha_movimiento||'","'||--fecha_transaccion
	'admin@siep.com'||'","'||--username
	'01-01-2017'||'",'||--creacion
	mcca.id||','||
	xh.valor_desembolso  ||','|| --coalesce(xh.interes_corriente,0)+coalesce(xh.seguro,0)+coalesce(xh.deuda,0)+coalesce(xh.mora,0) ||','||--acumulado cargo capital
	coalesce(xh.deuda,0)||','||--acumulado abono capital
	coalesce(mcdlc.saldoanteriormoratorios,0)||','||--xmora.valor_mora;tabla diana mora acumuladomoragenerada
	COALESCE(xh.mora,0)||','||--xmora.mora; acumuladoabonomora
	coalesce(xpp2.acumulado_interes,0)||','||--acumulado corriente gene
	coalesce(xh.interes_corriente,0)||','||--acumulado abono corriente
	coalesce(xpp2.acumulado_seguro,0)||','||--acumulado cuota seguro
	coalesce(xh.seguro,0)||',"'||--acumulado abono seguro
	xh.fecha_movimiento||'",'||--fecha_real_de pago
	mcdlc.id||','||--m_cli_detalle_liquidacion_cuotaid
	coalesce(xh.interes_corriente,0)+coalesce(xh.seguro,0)+coalesce(xh.deuda,0)+coalesce(xh.mora,0)||','||--valor_transaccion
	coalesce(xpp2.valor_capital,0)||','||--capitalperiodo
	coalesce(xh.deuda,0)||','||--abono capital
	coalesce(xpp2.valor_interes,0)||','||--interes corriente periodo
	coalesce(xh.interes_corriente,0)||','||--abono corriente
	coalesce(mcdlc.interesmoratorioperiodo,0)||','|| --interes moratorio periodo
	COALESCE(xh.mora,0)||','||--xmora.mora;abono moratorios
	coalesce(xpp2.valor_seguro,0)||','|| --cuota seguro
	coalesce(xh.Seguro,0)||',"'|| --abono seguro
	'Autorizado'||'");'--estado	
from 
	(select xpp.id,xpp.numero_credito,xpp.cuota,
		xpp.valor_cuota,
			(select sum(valor_cuota) 
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_cuota,
		xpp.valor_interes,
		(select sum(valor_interes)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_interes,
		xpp.valor_capital,
		(select sum(valor_capital)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_capital,
		xpp.valor_saldo,
		(select sum(valor_saldo)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_saldo,
		xpp.valor_seguro,
		(select sum(valor_seguro)
				from 
				xeo_plandepagos xpp1
			where xpp1.id<=xpp.id and xpp.numero_credito=xpp1.numero_credito) acumulado_seguro	
		from xeo_plandepagos xpp
		order by xpp.numero_credito,xpp.id
	) xpp2
inner join  (select xeoh.numero_colocacion,cuota,
		coalesce(xeoh2.valor_desembolso,0) valor_desembolso,
		fecha_movimiento,
		SUM(case
		when POSITION( 'Int.' IN transaccion)>0
			then coalesce(VALOR_TRANSACCION,0) end)interes_corriente,
		sum(case
		when POSITION( 'Seguro' IN transaccion)>0 
			then coalesce(valor_transaccion,0) end ) seguro,
		sum(case
		when POSITION( 'Deuda' IN transaccion)>0  
			then coalesce(valor_transaccion,0) end ) deuda,
		sum(case
		when POSITION( 'Mora' IN transaccion)>0  
			then coalesce(valor_transaccion,0) end ) mora,
		sum(saldo_capital) capital
		from xeo_historico xeoh
		inner join (select numero_colocacion,valor_desembolso
		 from xeo_historico
		 where cuota is null)xeoh2
		on ( xeoh2.numero_colocacion=xeoh.numero_colocacion )
		where cuota is not null --and xeoh.numero_colocacion='LIB-0002001'
		group by 1,2,3,4		
	) xh
	on (xh.numero_colocacion=xpp2.numero_credito and xh.cuota=xpp2.cuota)
		
inner join 
	(select 
	descripcion,substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id,
	fecha
	from m_cli_comprobante_credito) mccc
		on (trim(xh.numero_colocacion) = trim(mccc.credito) and (mccc.fecha=xh.fecha_movimiento))

inner join 
	(select id,numerocredito,
		(case
		when modalidadpago='Mensual' then 1
		when modalidadpago='Bimestral' then 2
		when modalidadpago='Trimestral' then  3
		when modalidadpago='Cuatrimestral' then  4
		when modalidadpago='Pentamestral' then  5
		when modalidadpago='Semestral' then 6
		when modalidadpago='Septamestral' then 7
		when modalidadpago='Octamestral' then 8
		when modalidadpago='Nonamestral' then 9
		when modalidadpago='Decamestral' then 10
		when modalidadpago='Anual' then  12
		end) mesespago
		from m_cli_credito_aprobado 		
	) mcca
	on (trim(mcca.numerocredito)=trim(xpp2.numero_credito))	

inner join 
	(select 
		substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
		from m_cli_liquidacion_cuota) mclc
			on (trim(xpp2.numero_credito) = trim(mclc.credito))

inner join 
	m_cli_detalle_liquidacion_cuota mcdlc 
		on (mcdlc.m_cli_credito_aprobadoid=mcca.id) and (cast(xpp2.cuota as integer)=mcdlc.numerocuota)
		

inner join 
	m_cli_detalle_comprobante_credito mcdcc
		on (mcdcc.m_cli_comprobante_creditoid = mccc.id
			 and mcdcc.m_cli_credito_aprobadoid=mcca.id
			 and mcdcc.m_cli_detalle_liquidacion_cuotaid=mcdlc.id)
			 			 			 

---------------------------------------------------	
///Consultar para verificar los updates que siguen.
---------------------------------------------------	

select * from m_cli_kardex_credito
order by m_cli_credito_aprobadoid

			 
---------------------------------------------------			 
---- m_cli_kardex_credito 1. --acumuladomoragenerada viene de detalle liquidacion cuota.
---------------------------------------------------
/*update 
	m_cli_kardex_credito
set
	acumuladomoragenerada = 	
					coalesce((select 
						sum(k1.acumuladomoragenerada) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION ),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)*/

---------------------------------------------------
---- m_cli_kardex_credito 2.
--------------------------------------------------- 
update 
	m_cli_kardex_credito
set
	acumuladoabonocapital = 	
					coalesce((select 
						sum(k1.acumuladoabonocapital) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)

---------------------------------------------------
---- m_cli_kardex_credito 3.
---------------------------------------------------
/*
No se debe realizar debido a que ya viene dado desde plan de pagos.
update 
	m_cli_kardex_credito
set
	acumuladocorrientegenerado = 	
					coalesce((select 
						sum(k1.acumuladocorrientegenerado) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION ),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)*/

---------------------------------------------------
---- m_cli_kardex_credito 4.
---------------------------------------------------
update 
	m_cli_kardex_credito
set
	acumuladoabonocorriente = 	
					coalesce((select 
						sum(k1.acumuladoabonocorriente) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION ),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)

---------------------------------------------------
---- m_cli_kardex_credito 5.
---------------------------------------------------
/*update 
	m_cli_kardex_credito
set
	acumuladocuotaseguro = 	
					coalesce((select 
						sum(k1.acumuladocuotaseguro) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)*/

---------------------------------------------------
---- m_cli_kardex_credito 6.
---------------------------------------------------
update 
	m_cli_kardex_credito
set
	acumuladoabonoseguro = 	
					coalesce((select 
						sum(k1.acumuladoabonoseguro) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)

---------------------------------------------------
---- m_cli_kardex_credito 7.
---------------------------------------------------
/*update 
	m_cli_kardex_credito
set
	acumuladocargocapital = 	
					coalesce((select 
						sum(k1.acumuladocargocapital) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)*/

---------------------------------------------------
---- m_cli_kardex_credito 8.
---------------------------------------------------
update 
	m_cli_kardex_credito
set
	acumuladoabonomora = 	
					coalesce((select 
						sum(k1.acumuladoabonomora) 
					from 
						m_cli_kardex_credito k1
					inner join m_cli_detalle_liquidacion_cuota dlc1 
							on ( k1.m_cli_detalle_liquidacion_cuotaid=dlc1.id)
					where 
						k1.m_cli_credito_aprobadoid = m_cli_kardex_credito.m_cli_credito_aprobadoid
					and 
						dlc1.numerocuota<=dlc2.numerocuota
					and 
						k1.FECHATRANSACCION<=m_cli_kardex_credito.FECHATRANSACCION ),0)
						
from m_cli_detalle_liquidacion_cuota dlc2
where ( m_cli_kardex_credito.m_cli_detalle_liquidacion_cuotaid=dlc2.id)

---------------------------------------------------
--- m_cli_kardex_cuota						
---------------------------------------------------
SELECT 
	'insert into m_cli_kardex_cuota (m_cli_kardex_creditoid,m_cli_detalle_liquidacion_cuotaid,abonomoratorios,abonocorriente,abonocapital,abonoseguro,creacion)values ('||
	mckc.id||','||
	mcdlc.id||','||
	0||','||--coalesce(xh.mora,0)
	coalesce(xh.interes_corriente,0)||','||
	coalesce(xh.deuda,0)||','||
	coalesce(xh.seguro,0)||',"'||'01-01-2017'||'");'

from    (
	select numero_colocacion,cuota,valor_desembolso,fecha_movimiento,
		SUM(case
		when POSITION( 'Int.' IN transaccion)>0
			then coalesce(VALOR_TRANSACCION,0) end)interes_corriente,
		sum(case
		when POSITION( 'Seguro' IN transaccion)>0 
			then coalesce(valor_transaccion,0) end ) seguro,
		sum(case
		when POSITION( 'Deuda' IN transaccion)>0  
			then coalesce(valor_transaccion,0) end ) deuda,
		sum(case
		when POSITION( 'Mora' IN transaccion)>0  
			then coalesce(valor_transaccion,0) end ) mora,
		sum(saldo_capital) capital
		from xeo_historico
		where cuota is not null
		group by 1,2,3,4
		
	) xh
		
inner join 
	(select 
	descripcion,fecha,substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
	from m_cli_comprobante_credito) mccc
	on (trim(xh.numero_colocacion) = trim(mccc.credito) and (mccc.fecha=xh.fecha_movimiento))

inner join 
	(select id,numerocredito
		from m_cli_credito_aprobado
	) mcca
	on (trim(mcca.numerocredito)=trim(xh.numero_colocacion))	

inner join 
	(select 
		substring(descripcion from position ('Num.Credito:' in descripcion)+12 for char_length(descripcion)) as credito,id
		from m_cli_liquidacion_cuota) mclc
			on (trim(xh.numero_colocacion) = trim(mclc.credito))
		
inner join 
	m_cli_detalle_liquidacion_cuota mcdlc
		on (mcdlc.m_cli_credito_aprobadoid=mcca.id) and (cast(xh.cuota as integer)=mcdlc.numerocuota)

inner join 
	m_cli_detalle_comprobante_credito mcdcc
		on (mcdcc.m_cli_comprobante_creditoid = mccc.id
			 and mcdcc.m_cli_credito_aprobadoid=mcca.id
			 and mcdcc.m_cli_detalle_liquidacion_cuotaid=mcdlc.id)

inner join 
	m_cli_kardex_credito mckc
		on (mckc.m_cli_detalle_comprobante_creditoid=mcdcc.id
			and mckc.m_cli_credito_aprobadoid=mcca.id
			and mckc.m_cli_detalle_liquidacion_cuotaid=mcdlc.id)

						
						
////Delete tablas
//delete from m_cli_kardex_cuota;
//delete from m_cli_kardex_credito;
//delete from m_cli_detalle_comprobante_credito;
//delete from m_cli_detalle_liquidacion_cuota;
//delete from m_cli_comprobante_credito;
//delete from m_cli_liquidacion_cuota;
//delete from m_cli_credito_aprobado;
//DELETE FROM XEO_HISTORICO
//DELETE FROM XEO_PLANDEPAGOS

//***************************************************************************************************************************
// verificar la informacion que se encuentra en detalle_liquidacion_cuota, para revision de saldos actuales de los creditos.
//***************************************************************************************************************************

select  NUMEROCREDITO,CAST(NUMEROCUOTA AS INTEGER) CUOTAS,
CAPITALPERIODO,ABONOCAPITAL,CAPITALPERIODO-ABONOCAPITAL as saldo_capital,
INTERESCORRIENTEPERIODO,ABONOCORRIENTE,INTERESCORRIENTEPERIODO-ABONOCORRIENTE as saldo_interes,
CUOTASEGURO,ABONOSEGURO,CUOTASEGURO-ABONOSEGURO as saldo_seguro,
ABONOMORATORIOS
 from m_cli_detalle_liquidacion_cuota MCDLC
INNER JOIN M_CLI_CREDITO_APROBADO MCCA ON (
MCDLC.M_CLI_CREDITO_APROBADOID=MCCA.ID 
AND FORMADEEXTINCION='Vigente'
AND NUMEROCREDITO='LIB-0002233'
)
ORDER BY 2

--------
----------
-------------

select  NUMEROCREDITO,CAST(NUMEROCUOTA AS INTEGER) CUOTAS,
CAPITALPERIODO,ABONOCAPITAL,saldoActualCapital,
INTERESCORRIENTEPERIODO,ABONOCORRIENTE,saldoactualcorriente,
CUOTASEGURO,ABONOSEGURO,saldoactualseguro,
ABONOMORATORIOS
 from m_cli_detalle_liquidacion_cuota MCDLC
INNER JOIN M_CLI_CREDITO_APROBADO MCCA ON (
MCDLC.M_CLI_CREDITO_APROBADOID=MCCA.ID 
--AND FORMADEEXTINCION='Vigente'
--AND NUMEROCREDITO='LIB-0002233'
)
ORDER BY 2

--------------
------------------
------------------------
Para verificar informacion
-----------------------
---------------------
---------------
select mcca.numerocredito ,mckc.*
from m_cli_kardex_credito mckc
inner join m_cli_credito_aprobado mcca on (mckc.m_cli_credito_aprobadoid=mcca.id) 
where mcca.numerocredito='LIB-0001604'
order by m_cli_credito_aprobadoid

